<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>LINE è²¼åœ–æŠ½çç³»çµ± - é€²éšç‰ˆ</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 20px; line-height: 1.6; max-width: 1000px; margin: auto; background-color: #f0f2f5; }
        .instruction { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; border-top: 6px solid #00c300; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #fff; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd; }
        .stat-card span { display: block; font-size: 24px; font-weight: bold; color: #00c300; }
        textarea { width: 100%; height: 250px; margin-bottom: 15px; padding: 15px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; resize: vertical; }
        textarea:focus { border-color: #00c300; outline: none; }
        .result-container { display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; }
        .result-box { flex: 1; min-width: 300px; background: white; padding: 20px; border-radius: 12px; border: 1px solid #ddd; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        button { padding: 15px; background: #00c300; color: white; border: none; cursor: pointer; border-radius: 8px; font-size: 18px; font-weight: bold; width: 100%; transition: 0.3s; }
        button:hover { background: #009e00; box-shadow: 0 4px 12px rgba(0,195,0,0.3); }
        h3 { border-bottom: 2px solid #00c300; padding-bottom: 10px; color: #333; margin-top: 0; }
        .note { color: #666; font-size: 0.85em; margin-bottom: 10px; }
        ol { padding-left: 30px; }
        li { margin-bottom: 6px; font-family: 'Courier New', Courier, monospace; border-bottom: 1px dashed #eee; padding-bottom: 2px; }
    </style>
</head>
<body>

    <div class="instruction">
        <h2>ğŸ LINE è²¼åœ–æŠ½çç³»çµ±</h2>
        <p><strong>æŠ½çè¦å‰‡èªªæ˜ï¼š</strong></p>
        <ul>
            <li><strong>åå–®è¼¸å…¥ï¼š</strong>æ”¯æ´å¾ Excel ç›´æ¥è¤‡è£½è²¼ä¸Šï¼ˆå§“åèˆ‡æ‰‹æ©Ÿé–“æœ‰ç©ºæ ¼æˆ– Tab å‡å¯ï¼‰ã€‚</li>
            <li><strong>æ©Ÿæœƒä¸Šé™ï¼š</strong>æ¯æ”¯æ‰‹æ©Ÿè™Ÿç¢¼æœ€å¤šæ“æœ‰ <strong>2 æ¬¡</strong> æŠ½çæ©Ÿæœƒã€‚</li>
            <li><strong>é‡è¤‡ä¸­çï¼š</strong>åŒä¸€å€‹äººï¼ˆæ‰‹æ©Ÿè™Ÿç¢¼ï¼‰åœ¨åŒä¸€è¼ªä¸­ä¸æœƒé‡è¤‡å¾—çï¼Œç›´åˆ° 100 ä»½æŠ½å®Œã€‚</li>
            <li><strong>éš±ç¢¼è¦ç¯„ï¼š</strong>2-3å­—ä¸­æ–‡åŸ·è¡Œéš±ç¢¼ï¼›ã€Œç„¡æä¾›ã€åŠç‰¹æ®Šæ ¼å¼å‰‡å®Œæ•´é¡¯ç¤ºã€‚</li>
        </ul>
    </div>

    <p>è«‹åœ¨æ­¤è²¼å…¥åå–®ï¼ˆæ”¯æ´ Excel ç›´æ¥è²¼ä¸Šï¼Œå§“åèˆ‡æ‰‹æ©Ÿé ˆåˆ†åˆ—ï¼‰ï¼š</p>
    <textarea id="inputList" placeholder="ç°¡æƒ ç	0921667982&#10;Lee	0988187981&#10;	0922472550 (å§“åç©ºç™½ç¯„ä¾‹)"></textarea>
    
    <button onclick="runLottery()">é–‹å§‹è¨ˆç®—çµ±è¨ˆä¸¦æŠ½å‡º 100 ä»½çé …</button>

    <div id="summary" style="display:none; margin-top: 30px;">
        <h3 style="text-align: center;">ğŸ“Š æŠ½çæ‘˜è¦çµ±è¨ˆ</h3>
        <div class="stat-grid">
            <div class="stat-card">åŸå§‹è³‡æ–™ç¸½æ•¸<span id="statTotal">0</span></div>
            <div class="stat-card">æœ‰æ•ˆåƒåŠ äººæ•¸<span id="statUnique">0</span></div>
            <div class="stat-card">é‡è¤‡æŠ•ä»¶è€…<span id="statDup">0</span></div>
            <div class="stat-card">é ä¼°ä¸­çæ©Ÿç‡<span id="statRate">0%</span></div>
        </div>

        <div class="result-container">
            <div class="result-box">
                <h3>ğŸ“¢ å…¬å¸ƒç”¨åå–® (éš±ç¢¼ç‰ˆ)</h3>
                <p class="note">å·²è‡ªå‹•è™•ç†ä¸­æ–‡å­—éš±ç¢¼åŠæ‰‹æ©Ÿé®è”½ã€‚</p>
                <ol id="maskedList"></ol>
            </div>
            <div class="result-box">
                <h3>ğŸ”‘ æ ¸å°ç”¨åå–® (å®Œæ•´ç‰ˆ)</h3>
                <p class="note">ä¾›å…§éƒ¨ç¢ºèªç™¼çä½¿ç”¨ã€‚</p>
                <ol id="fullList"></ol>
            </div>
        </div>
    </div>

    <script>
        function maskName(name) {
            if (name === "ç„¡æä¾›") return name;
            const isChinese = /^[\u4E00-\u9FA5]+$/.test(name);
            if (isChinese) {
                if (name.length === 2) return name[0] + "O";
                if (name.length === 3) return name[0] + "O" + name[2];
            }
            return name;
        }

        function runLottery() {
            const rawText = document.getElementById('inputList').value.trim();
            if (!rawText) return alert("è«‹è²¼å…¥æŠ½çåå–®");

            const lines = rawText.split('\n');
            const totalPrizes = 100;
            
            let rawCount = 0;
            let participantsMap = {}; // ç”¨æ‰‹æ©Ÿç•¶ key
            let phoneToNames = {}; // å­˜æ‰‹æ©Ÿå°æ‡‰çš„æ‰€æœ‰å§“åï¼Œç”¨æ–¼çµ±è¨ˆ

            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (!trimmedLine) return;
                
                rawCount++;
                // æ”¯æ´ Tab (\t), æ–œç·š, æˆ–å¤šå€‹ç©ºæ ¼åˆ†éš”
                let parts = trimmedLine.split(/\t|\/|\s{2,}/);
                let name = "", phone = "";

                if (parts.length >= 2) {
                    name = parts[0].trim();
                    phone = parts[1].trim();
                } else {
                    // è™•ç†åªæœ‰æ‰‹æ©Ÿæˆ–æ ¼å¼ä¸è¦å‰‡çš„æƒ…æ³
                    phone = parts[0].trim();
                }

                // æ¸…ç†æ‰‹æ©Ÿè™Ÿç¢¼ä¸­çš„éæ•¸å­—(å¦‚ç©ºæ ¼æˆ–é€£å­—è™Ÿ)
                phone = phone.replace(/[^\d]/g, '');
                if (!phone) return;

                if (!name || name.length === 0) name = "ç„¡æä¾›";

                if (!participantsMap[phone]) {
                    participantsMap[phone] = { name: name, count: 1 };
                    phoneToNames[phone] = [name];
                } else {
                    if (participantsMap[phone].count < 2) {
                        participantsMap[phone].count++;
                    }
                    phoneToNames[phone].push(name);
                }
            });

            // çµ±è¨ˆè³‡æ–™
            const uniquePhones = Object.keys(participantsMap);
            const duplicateCount = uniquePhones.filter(p => phoneToNames[p].length > 1).length;
            
            // å»ºç«‹æŠ½çæ± 
            let pool = [];
            for (let phone in participantsMap) {
                for (let i = 0; i < participantsMap[phone].count; i++) {
                    pool.push({ name: participantsMap[phone].name, phone: phone });
                }
            }

            // åŸ·è¡ŒæŠ½ç
            let winners = [];
            let tempPool = [...pool];
            while (winners.length < totalPrizes && tempPool.length > 0) {
                let roundWinners = [];
                let roundUsed
