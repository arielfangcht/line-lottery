<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>LINE è²¼åœ–æŠ½çç³»çµ±</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 20px; max-width: 900px; margin: auto; background: #f4f4f4; color: #333; }
        .box { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .instruction { background: #e8f5e9; padding: 20px; border-left: 5px solid #00c300; margin-bottom: 25px; border-radius: 5px; }
        .instruction h2 { margin-top: 0; color: #2e7d32; }
        .instruction ul { padding-left: 20px; margin-bottom: 0; }
        textarea { width: 100%; height: 200px; box-sizing: border-box; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        button { width: 100%; padding: 15px; background: #00c300; color: white; border: none; font-size: 18px; font-weight: bold; cursor: pointer; border-radius: 5px; transition: 0.3s; margin-top: 10px; }
        button:hover { background: #009e00; }
        .stats { display: flex; justify-content: space-around; margin: 25px 0; background: #fff; padding: 20px; border-radius: 10px; border: 1px solid #ddd; text-align: center; }
        .stats div { flex: 1; }
        .stats b { display: block; font-size: 24px; color: #00c300; }
        .res-box { display: flex; gap: 20px; flex-wrap: wrap; }
        .col { flex: 1; min-width: 300px; background: white; padding: 20px; border-radius: 10px; border: 1px solid #ddd; }
        .col h3 { border-bottom: 2px solid #00c300; padding-bottom: 10px; margin-top: 0; }
        ol { padding-left: 30px; }
        li { margin-bottom: 5px; font-family: monospace; border-bottom: 1px solid #f9f9f9; }
    </style>
</head>
<body>

    <div class="instruction">
        <h2>ğŸ æŠ½çé‚è¼¯èªªæ˜</h2>
        <ul>
            <li><strong>çé …æ•¸é‡ï¼š</strong>å›ºå®šæŠ½å‡º 100 ä»½ LINE è²¼åœ–ã€‚</li>
            <li><strong>åƒåŠ è³‡æ ¼ï¼š</strong>æ¯æ”¯æ‰‹æ©Ÿè™Ÿç¢¼ä¸Šé™æ“æœ‰ <strong>2 æ¬¡</strong> æŠ½çæ©Ÿæœƒï¼ˆè‹¥é‡è¤‡å¡«ç­”æ¬¡æ•¸è¶…éï¼Œç³»çµ±è‡ªå‹•æˆªæ–·ï¼‰ã€‚</li>
            <li><strong>æŠ½çæµç¨‹ï¼š</strong>æ¡å¤šè¼ªåˆ¶éš¨æ©ŸæŠ½å–ï¼Œæ¯ä¸€è¼ªæœƒå‰”é™¤è©²è¼ªå·²ä¸­çä¹‹è™Ÿç¢¼ï¼Œç¢ºä¿åŒä¸€äººåœ¨åŒä¸€è¼ªä¸æœƒé‡è¤‡å¾—çï¼Œç›´åˆ°æŠ½æ»¿ 100 ä»½æˆ–åå–®æŠ½ç©ºç‚ºæ­¢ã€‚</li>
            <li><strong>éš±ç¢¼è¦ç¯„ï¼š</strong>
                <ul>
                    <li>2å­—ä¸­æ–‡ï¼šé®è”½ç¬¬2å­—ï¼ˆä¾‹ï¼šç‹Oï¼‰ã€‚</li>
                    <li>3å­—ä¸­æ–‡ï¼šé®è”½ä¸­é–“å­—ï¼ˆä¾‹ï¼šç‹Oæ˜ï¼‰ã€‚</li>
                    <li><strong>ç„¡æä¾›ï¼š</strong>ç›´æ¥é¡¯ç¤ºï¼Œä¸åŸ·è¡Œéš±ç¢¼ã€‚</li>
                    <li>å…¶é¤˜æ ¼å¼ï¼ˆè‹±æ–‡ã€æ³¨éŸ³ã€é•·å§“åï¼‰ï¼šå®Œæ•´é¡¯ç¤ºå…¨åã€‚</li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="box">
        <p><strong>è«‹åœ¨æ­¤è²¼å…¥ Excel åå–®ï¼ˆå§“åèˆ‡æ‰‹æ©Ÿè™Ÿç¢¼ï¼‰ï¼š</strong></p>
        <textarea id="inputList" placeholder="ç°¡æƒ ç	0921667982&#10;Lee	0988187981&#10;	0922472550 (å§“åç©ºç™½ç¯„ä¾‹)"></textarea>
        <button onclick="draw()">ç«‹å³éš¨æ©ŸæŠ½å‡º 100 ä½å¾—çè€…</button>
    </div>

    <div id="result" style="display:none;">
        <h3 style="text-align: center;">ğŸ“Š æŠ½ççµ±è¨ˆæ‘˜è¦</h3>
        <div class="stats">
            <div>åŸå§‹è²¼å…¥ç¸½ç­†æ•¸<b id="s1">0</b></div>
            <div>æœ‰æ•ˆåƒåŠ äººæ•¸<b id="s2">0</b></div>
            <div>é‡è¤‡æŠ•ä»¶äººæ•¸<b id="s4">0</b></div>
            <div>ç²çæ©Ÿç‡<b id="s3">0%</b></div>
        </div>
        <div class="res-box">
            <div class="col"><h3>ğŸ“¢ å…¬å¸ƒåå–® (éš±ç¢¼ç‰ˆ)</h3><ol id="list1"></ol></div>
            <div class="col"><h3>ğŸ”‘ æ ¸å°æ¸…å–® (å®Œæ•´ç‰ˆ)</h3><ol id="list2"></ol></div>
        </div>
    </div>

    <script>
        function draw() {
            var text = document.getElementById('inputList').value.trim();
            if(!text) return alert("è«‹è²¼å…¥åå–®");
            var lines = text.split('\n');
            var map = {};
            var rawCount = 0;
            var duplicateCount = 0;

            lines.forEach(function(l) {
                var lineText = l.trim();
                if(!lineText) return;
                
                var p = lineText.split(/[\s\t]+/);
                var tel = p[p.length-1].replace(/[^\d]/g, '');
                if(tel.length < 8) return;
                
                var name = p.length > 1 ? p[0] : "ç„¡æä¾›";
                rawCount++;
                
                if(!map[tel]) {
                    map[tel] = {n: name, c: 1, rawTotal: 1};
                } else {
                    map[tel].rawTotal++;
                    if(map[tel].c < 2) map[tel].c++; // æ¯äººä¸Šé™2æ¬¡æ©Ÿæœƒ
                }
            });

            var uniquePhones = Object.keys(map);
            if(uniquePhones.length === 0) return alert("ç„¡æ³•è¾¨è­˜åå–®å…§å®¹ï¼Œè«‹ç¢ºèªæ ¼å¼æ˜¯å¦æ­£ç¢º");

            // è¨ˆç®—é‡è¤‡æŠ•ä»¶äººæ•¸
            var dups = 0;
            for(var k in map) { if(map[k].rawTotal > 1) dups++; }

            var pool = [];
            for(var k in map) { for(var i=0; i<map[k].c; i++) pool.push({n:map[k].n, t:k}); }
            
            var winners = [];
            while(winners.length < 100 && pool.length > 0) {
                pool.sort(function(){return Math.random()-0.5});
                var round = [], used = {}, next = [];
                for(var j=0; j<pool.length; j++) {
                    if(!used[pool[j].t] && round.length < (100-winners.length)) {
                        round.push(pool[j]); used[pool[j].t] = 1;
                    } else { next.push(pool[j]); }
                }
                winners = winners.concat(round);
                pool = next;
                if(round.length === 0) break;
            }

            document.getElementById('result').style.display = 'block';
            document.getElementById('s1').innerText = rawCount;
            document.getElementById('s2').innerText = uniquePhones.length;
            document.getElementById('s4').innerText = dups;
            document.getElementById('s3').innerText = (uniquePhones.length > 0 ? Math.min(100, (winners.length/uniquePhones.length)*100).toFixed(1) : 0) + "%";

            var l1 = document.getElementById('list1'), l2 = document.getElementById('list2');
            l1.innerHTML = ''; l2.innerHTML = '';
            winners.forEach(function(w) {
                var isChi = /^[\u4E00-\u9FA5]+$/.test(w.n);
                var mName = w.n;
                if(w.n !== "ç„¡æä¾›" && isChi) {
                    if(w.n.length == 2) mName = w.n[0]+"O";
                    else if(w.n.length == 3) mName = w.n[0]+"O"+w.n[2];
                }
                var mTel = w.t.replace(/(\d{4})(\d{4})(\d{2})/, "$1****$3");
                l1.innerHTML += "<li>"+mName+" / "+mTel+"</li>";
                l2.innerHTML += "<li>"+w.n+" / "+w.t+"</li>";
            });
            window.scrollTo({ top: document.getElementById('result').offsetTop - 20, behavior: 'smooth' });
        }
    </script>
</body>
</html>
